layers:
    earth:
        data: { source: mapbox }
        draw:
            polygons:
                order: 10 # TODO
                color: global.earth_color

    admin:
        data: { source: mapbox}
        filter: [ admin_level: [2, 3] ]
        draw:
            boundary_dashes:
                order: 200 # TODO
                color: global.boundary_color
                width: 1px

    water:
        data: { source: mapbox}
        filter: {not: {structure: tunnel} }

        draw:
            lines:
                order: 200 # TODO
                join: round
                cap: square

        water_areas:
            draw:
                polygons:
                    order: 10 # TODO
                    color: global.water_color

    waterway:
        data: { source: mapbox}
        filter: {not: {structure: tunnel} }

        draw:
            lines:
                order: 20 # TODO
                join: round
                cap: square

        shore_lines: # TODO: not visible currently (don't know if this will work)
            filter: { boundary: false, $zoom: { min: 16 }, area: { min: 700 } }
            draw:
                lines-coast:
                    order: 220
                    width: [[16,20px],[18,10m]] # actually visually 1/3
                    color: global.water_color

        stream_lines:
            filter: { class: [stream, ditch, drain], $zoom: { min: 15 }}
            draw:
                lines:
                    color: global.water_color
                    width: [[15, 1px], [17, 2px], [18, 5m]]


    building:
        data: { source: mapbox}
        filter: { [ underground: false ], $zoom: { min: 16 } }

        draw:
            buildings-style:
                order: 50 # TODO
                color: global.building_color
                extrude: true
            buildings-outline-style:
                order: 60 # TODO
                color: global.building_outline_color
                width: [[16, 1px], [18,2px], [19,4px]]
                extrude: true

    barrier_line:
        data: { source: mapbox}
        filter: { class: [fence, gate, hedge], $zoom: { min: 16 } }
        draw:
            buildings-outline-style:
                order: 100 # TODO
                color: global.building_outline_color
                width: [[15, 1px], [18, 2m]]

    landuse:
        data: { source: mapbox}
        draw:
            polygons:
                order: 5 # TODO
                color: global.landuse_color

        squares: # TODO: check if this works
            filter: { type: [pedestrian], $zoom: { min: 17 } }
            draw:
                lines:
                    color: global.square_outline_color
                    width: function () { return 1/4 * Math.log($zoom); }
                    order: 200
                polygons:
                    color: global.square_color
                    order: 360

styles:
    boundary_dashes:
        base: lines
        dash: [1, 2]
    buildings-style:
        base: polygons
        blend: opaque
    buildings-outline-style:
        base: lines
        blend: inlay
    lines-coast:
        base: lines
        texcoords: true
        blend: inlay
        shaders:
            uniforms:
                u_waves: 1.5
                u_speed: 0.08
                u_color: [0.6,0.7,1.,1.]
            blocks:
                color: |
                    float x = (v_texcoord.x - 0.495) * 2.;
                    if(x > 0.0) {
                        float opacity = 1.-x;
                        float waves = fract(u_waves*(1.-x)-u_time*u_speed);
                        color = mix(color, u_color, opacity * waves);
                    } else {
                        color.a = 0.0;
                    }
